name: PR Notification
on:
  pull_request:
    types: [opened, closed, reopened]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: PR Notification
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_USER: ${{ github.event.pull_request.user.login }}
          PR_ACTION: ${{ github.event.action }}
          REPO_NAME: ${{ github.repository }}
        run: |
          if [ "$PR_ACTION" = "opened" ]; then
            EMOJI="üÜï"
            COLOR="3447003"
          elif [ "$PR_ACTION" = "closed" ] && [ "${{ github.event.pull_request.merged }}" = "true" ]; then
            EMOJI="‚úÖ"
            COLOR="3066993"
          elif [ "$PR_ACTION" = "closed" ]; then
            EMOJI="‚ùå"
            COLOR="15158332"
          else
            EMOJI="üîÑ"
            COLOR="16776960"
          fi
          curl -H "Content-Type: application/json" \
            -d "{\"embeds\":[{\"title\":\"${EMOJI} [${PR_ACTION}] ${PR_TITLE}\",\"url\":\"${PR_URL}\",\"color\":${COLOR},\"fields\":[{\"name\":\"Repo\",\"value\":\"${REPO_NAME}\",\"inline\":true},{\"name\":\"Author\",\"value\":\"${PR_USER}\",\"inline\":true}]}]}" \
            "$WEBHOOK_URL"
